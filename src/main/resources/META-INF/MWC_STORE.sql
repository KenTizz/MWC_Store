CREATE DATABASE MWC_STORE
USE MWC_STORE

-- Dép
CREATE TABLE DEP (
	Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	Ma VARCHAR(20) UNIQUE,
	Ten NVARCHAR(50) DEFAULT NULL,
	HinhAnh NVARCHAR(50),
	NgayThem DATE,
	NgaySuaCuoi DATE,
	TrangThai INT
)

-- Loại dép
CREATE TABLE LOAIDEP (
	Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	Ma VARCHAR(20) UNIQUE,
	Ten NVARCHAR(50) DEFAULT NULL,
	NgayThem DATE,
	NgaySuaCuoi DATE,
	TrangThai INT
)

-- Màu sắc
CREATE TABLE MAUSAC (
	Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	Ma VARCHAR(20) UNIQUE,
	Ten NVARCHAR(50) DEFAULT NULL,
	NgayThem DATE,
	NgaySuaCuoi DATE,
	TrangThai INT
)

-- Chất liệu
CREATE TABLE CHATLIEU (
	Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	Ma VARCHAR(20) UNIQUE,
	Ten NVARCHAR(50) DEFAULT NULL,
	NgayThem DATE,
	NgaySuaCuoi DATE,
	TrangThai INT
)

-- Nhà sản xuất
CREATE TABLE NSX (
	Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	Ma VARCHAR(20) UNIQUE,
	Ten NVARCHAR(50) DEFAULT NULL,
	NgayThem DATE,
	NgaySuaCuoi DATE,
	TrangThai INT
)

-- Size
CREATE TABLE SIZE (
	Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	Ma VARCHAR(20) UNIQUE,
	KichCo FLOAT,
	NgayThem DATE,
	NgaySuaCuoi DATE,
	TrangThai INT
)

-- Chi tiết dép
CREATE TABLE CHITIETDEP (
	Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	IdDep UNIQUEIDENTIFIER,
	IdLoaiDep UNIQUEIDENTIFIER,
	IdMauSac UNIQUEIDENTIFIER,
	IdChatLieu UNIQUEIDENTIFIER,
	IdNsx UNIQUEIDENTIFIER,
	IdSize UNIQUEIDENTIFIER,
	KichCo INT DEFAULT NULL,
	MoTa NVARCHAR(50) DEFAULT NULL,
	SoLuong INT,
	GiaNhap DECIMAL(20,0) DEFAULT NULL,
	GiaBan DECIMAL(20,0) DEFAULT NULL,
	NgayThem DATE,
	NgaySuaCuoi DATE,
	TrangThai INT
)

-- Chức Vụ
CREATE TABLE CHUCVU (
	Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	Ma VARCHAR(20) UNIQUE,
	Ten NVARCHAR(50) DEFAULT NULL
)

-- Người dùng
CREATE TABLE NGUOIDUNG (
	Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	IdCV UNIQUEIDENTIFIER,
	Ma VARCHAR(20) UNIQUE,
	Ten NVARCHAR(50) DEFAULT NULL,
	Email VARCHAR(MAX),
	Sdt VARCHAR(20) DEFAULT NULL,
	DiaChi NVARCHAR(255) DEFAULT NULL,
	GioiTinh INT,
	MatKhau VARCHAR(MAX),
	TrangThai INT,
	HinhAnh NVARCHAR(50)
)

-- Khách hàng
CREATE TABLE KHACHHANG (
	Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	Ma VARCHAR(20) UNIQUE,
	Ten NVARCHAR(50) DEFAULT NULL,
	Sdt VARCHAR(20) DEFAULT NULL,
	DiaChi NVARCHAR(255) DEFAULT NULL,
	DiemTichLuy INT
)

-- Hóa đơn
CREATE TABLE HOADON (
	Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
	Ma VARCHAR(20) UNIQUE,
	IdND UNIQUEIDENTIFIER,
	IdKH UNIQUEIDENTIFIER,
	NgayTao DATE DEFAULT NULL,
	NgayThanhToan DATE DEFAULT NULL,
	TrangThai INT
)

-- Hóa đơn chi tiết
CREATE TABLE HOADONCHITIET (
	IdCTD UNIQUEIDENTIFIER,
	IdHD UNIQUEIDENTIFIER,
	DonGia DECIMAL(20,0) DEFAULT 0,
	SoLuong INT
	CONSTRAINT FK_HDCT_HD FOREIGN KEY (IdHd) REFERENCES HoaDon (Id),
	CONSTRAINT FK_HDCT_CTD FOREIGN KEY (IdCtd) REFERENCES ChiTietDep (Id),
	CONSTRAINT PK_HDCT PRIMARY KEY (IdCTD,IdHD)
)



ALTER TABLE CHITIETDEP ADD CONSTRAINT FK_CTD_DEP FOREIGN KEY (IdDep) REFERENCES Dep(Id)

ALTER TABLE CHITIETDEP ADD CONSTRAINT FK_CTD_LOAIDEP FOREIGN KEY (IdLoaiDep) REFERENCES LoaiDep(Id)

ALTER TABLE CHITIETDEP ADD CONSTRAINT FK_CTD_MAUSAC FOREIGN KEY (IdMauSac) REFERENCES MauSac(Id)

ALTER TABLE CHITIETDEP ADD CONSTRAINT FK_CTD_CHATLIEU FOREIGN KEY (IdChatLieu) REFERENCES ChatLieu(Id)

ALTER TABLE CHITIETDEP ADD CONSTRAINT FK_CTD_NSX FOREIGN KEY (IdNsx) REFERENCES NSX(Id)

ALTER TABLE CHITIETDEP ADD CONSTRAINT FK_CTD_SIZE FOREIGN KEY (IdSize) REFERENCES Size(Id)

ALTER TABLE NGUOIDUNG ADD CONSTRAINT FK_ND_CV FOREIGN KEY (IdCV) REFERENCES ChucVu(Id)

ALTER TABLE HOADON ADD CONSTRAINT FK_HD_ND FOREIGN KEY (IdNd) REFERENCES NguoiDung(Id)

ALTER TABLE HOADON ADD CONSTRAINT FK_HD_KH FOREIGN KEY (IdKh) REFERENCES KhachHang(Id)

INSERT INTO CHUCVU (Ma, Ten) VALUES ('CV01',N'Nhân viên')
INSERT INTO CHUCVU (Ma, Ten) VALUES ('CV02',N'Quản lý')