CREATE DATABASE MWC_STORE
USE MWC_STORE
GO

-- Dép
CREATE TABLE DEP (
	Id INT PRIMARY KEY IDENTITY(1,1),
	Ma VARCHAR(20) UNIQUE,
	Ten NVARCHAR(50) DEFAULT NULL,
	HinhAnh NVARCHAR(50),
	NgayThem DATE,
	NgaySuaCuoi DATE,
	TrangThai INT
)

-- Loại dép
CREATE TABLE LOAIDEP (
	Id INT PRIMARY KEY IDENTITY(1,1),
	Ma VARCHAR(20) UNIQUE,
	Ten NVARCHAR(50) DEFAULT NULL,
	NgayThem DATE,
	NgaySuaCuoi DATE,
	TrangThai INT
)

-- Màu sắc
CREATE TABLE MAUSAC (
	Id INT PRIMARY KEY IDENTITY(1,1),
	Ma VARCHAR(20) UNIQUE,
	Ten NVARCHAR(50) DEFAULT NULL,
	NgayThem DATE,
	NgaySuaCuoi DATE,
	TrangThai INT
)

-- Chất liệu
CREATE TABLE CHATLIEU (
	Id INT PRIMARY KEY IDENTITY(1,1),
	Ma VARCHAR(20) UNIQUE,
	Ten NVARCHAR(50) DEFAULT NULL,
	NgayThem DATE,
	NgaySuaCuoi DATE,
	TrangThai INT
)

-- Nhà sản xuất
CREATE TABLE NSX (
	Id INT PRIMARY KEY IDENTITY(1,1),
	Ma VARCHAR(20) UNIQUE,
	Ten NVARCHAR(50) DEFAULT NULL,
	NgayThem DATE,
	NgaySuaCuoi DATE,
	TrangThai INT
)

-- Size
CREATE TABLE SIZE (
	Id INT PRIMARY KEY IDENTITY(1,1),
	Ma VARCHAR(20) UNIQUE,
	KichCo FLOAT,
	NgayThem DATE,
	NgaySuaCuoi DATE,
	TrangThai INT
)

-- Chi tiết dép
CREATE TABLE CHITIETDEP (
	Id INT PRIMARY KEY IDENTITY(1,1),
	IdDep INT,
	IdLoaiDep INT,
	IdMauSac INT,
	IdChatLieu INT,
	IdNsx INT,
	IdSize INT,
	MoTa NVARCHAR(50) DEFAULT NULL,
	SoLuong INT,
	GiaNhap DECIMAL(20,0) DEFAULT NULL,
	GiaBan DECIMAL(20,0) DEFAULT NULL,
	NgayThem DATE,
	NgaySuaCuoi DATE,
	TrangThai INT
)

-- Chức Vụ
CREATE TABLE CHUCVU (
	Id INT PRIMARY KEY IDENTITY(1,1),
	Ma VARCHAR(20) UNIQUE,
	Ten NVARCHAR(50) DEFAULT NULL
)

-- Người dùng
CREATE TABLE NGUOIDUNG (
	Id INT PRIMARY KEY IDENTITY(1,1),
	IdCV INT,
	Ma VARCHAR(20) UNIQUE,
	Ten NVARCHAR(50) DEFAULT NULL,
	Email VARCHAR(MAX),
	Sdt VARCHAR(20) DEFAULT NULL,
	DiaChi NVARCHAR(255) DEFAULT NULL,
	GioiTinh INT,
	MatKhau VARCHAR(MAX),
	TrangThai INT,
	HinhAnh NVARCHAR(50)
)

-- Khách hàng
CREATE TABLE KHACHHANG (
	Id INT PRIMARY KEY IDENTITY(1,1),
	Ma VARCHAR(20) UNIQUE,
	Ten NVARCHAR(50) DEFAULT NULL,
	Sdt VARCHAR(20) DEFAULT NULL,
	DiaChi NVARCHAR(255) DEFAULT NULL,
	DiemTichLuy INT
)

-- Hóa đơn
CREATE TABLE HOADON (
	Id INT PRIMARY KEY IDENTITY(1,1),
	IdND INT,
	IdKH INT,
	NgayTao DATE DEFAULT NULL,
	NgayThanhToan DATE DEFAULT NULL,
	TrangThai INT
)

-- Hóa đơn chi tiết
CREATE TABLE HOADONCHITIET (
	IdCTD INT,
	IdHD INT,
	DonGia DECIMAL(20,0) DEFAULT 0,
	SoLuong INT
	CONSTRAINT FK_HDCT_HD FOREIGN KEY (IdHd) REFERENCES HoaDon (Id),
	CONSTRAINT FK_HDCT_CTD FOREIGN KEY (IdCtd) REFERENCES ChiTietDep (Id),
	CONSTRAINT PK_HDCT PRIMARY KEY (IdCTD,IdHD)
)


ALTER TABLE CHITIETDEP ADD CONSTRAINT FK_CTD_DEP FOREIGN KEY (IdDep) REFERENCES Dep(Id)

ALTER TABLE CHITIETDEP ADD CONSTRAINT FK_CTD_LOAIDEP FOREIGN KEY (IdLoaiDep) REFERENCES LoaiDep(Id)

ALTER TABLE CHITIETDEP ADD CONSTRAINT FK_CTD_MAUSAC FOREIGN KEY (IdMauSac) REFERENCES MauSac(Id)

ALTER TABLE CHITIETDEP ADD CONSTRAINT FK_CTD_CHATLIEU FOREIGN KEY (IdChatLieu) REFERENCES ChatLieu(Id)

ALTER TABLE CHITIETDEP ADD CONSTRAINT FK_CTD_NSX FOREIGN KEY (IdNsx) REFERENCES NSX(Id)

ALTER TABLE CHITIETDEP ADD CONSTRAINT FK_CTD_SIZE FOREIGN KEY (IdSize) REFERENCES Size(Id)

ALTER TABLE NGUOIDUNG ADD CONSTRAINT FK_ND_CV FOREIGN KEY (IdCV) REFERENCES ChucVu(Id)

ALTER TABLE HOADON ADD CONSTRAINT FK_HD_ND FOREIGN KEY (IdNd) REFERENCES NguoiDung(Id)

ALTER TABLE HOADON ADD CONSTRAINT FK_HD_KH FOREIGN KEY (IdKh) REFERENCES KhachHang(Id)


INSERT INTO CHUCVU (Ma, Ten) VALUES ('CV01',N'Quản lý')
INSERT INTO CHUCVU (Ma, Ten) VALUES ('CV02',N'Nhân viên')

INSERT INTO NGUOIDUNG
             (IdCV, Ma, Ten, Email, Sdt, DiaChi, GioiTinh, MatKhau, TrangThai, HinhAnh)
VALUES ('1','huongvn',N'Vũ Nguyên Hướng','huongvnph27229@fpt.edu.vn','0395080513',N'Nam Định',0,'123456',0,'mtkh.jpg')

INSERT INTO NGUOIDUNG
             (IdCV, Ma, Ten, Email, Sdt, DiaChi, GioiTinh, MatKhau, TrangThai, HinhAnh)
VALUES ('1','kimchi',N'Lại Thị Kim Chi','chiltkph26384@fpt.edu.vn','0999888999',N'Nam Định',0,'123456',0,'kimchi.jpg')


SELECT * FROM CHUCVU

SELECT * FROM NGUOIDUNG

select * from CHITIETDEP
